# Day 5: 高级逻辑: 过滤器 (Filters)

## 学习目标
- 理解过滤器的概念及其在自动化工作流中的作用。
- 学习使用过滤器，让工作流在特定条件下才执行。
- 掌握根据特定条件（如邮件标题、内容、发件人等）筛选和控制工作流执行路径的方法。

## 核心概念

### 什么是过滤器？
过滤器（Filter）是自动化工作流中的一个关键组件，它像一个智能的看门人。它会检查流入的数据（Items），并根据你设定的条件来决定这些数据是否可以通过。只有满足条件的数据才能继续在工作流中前进，不满足的则被拦下。

**举个例子：**
你设置了一个规则："只有来自老板的邮件才需要紧急处理"。过滤器就会检查每一封邮件，只让发件人是"老板"的邮件通过，其他的则忽略。

### 为什么需要过滤器？
- **精准控制：** 确保只有相关的数据才能触发后续操作，避免不必要的执行。例如，只处理带有特定关键词（如 "发票"、"报告"）的邮件。
- **节省资源：** 避免浪费API调用次数、计算资源和存储空间。
- **流程分支：** 在复杂的工作流中，可以根据不同条件将数据导向不同的处理路径。

## 实践操作: 为"邮件附件归档"流程添加过滤器

在之前的练习中，我们创建了一个自动将邮件附件保存到企业网盘或本地的流程。现在，我们要对它进行升级：只有当邮件标题包含"发票"这个关键词时，才执行保存操作。

### 准备工作
确保你已经完成了之前 "邮件附件归档" 的基础流程。它应该包含一个触发节点（如 IMAP Email）和一个执行操作的节点（如 Move/Write Binary File）。

### 操作步骤

#### 1. 添加 Filter 节点

- 在你的 n8n 工作流画布中，点击 `+` 号。
- 在节点搜索框中输入 `Filter`，然后选择并添加它。
- 将 `Filter` 节点拖动到 `IMAP Email` 节点和 `Write Binary File` 节点之间，并连接它们。

    *流程看起来应该是这样:*
    `IMAP Email` -> `Filter` -> `Write Binary File`

#### 2. 配置 Filter 节点

- 点击 `Filter` 节点，打开它的配置面板。
- **Conditions (条件)** 部分就是我们要设置规则的地方。默认是 `Keep Items that match` (保留匹配的项目)，这正是我们需要的。

- **Add Condition (添加条件)**
    - **Value 1**: 这里我们要设置待检查的数据。
        - 点击 `Add Expression`。
        - 在表达式编辑器中，我们要引用邮件的标题。通常，邮件标题的路径是 `{{ $json.subject }}`。你可以从左侧的 "INPUT" 面板中找到 `IMAP Email` 节点的输出，然后点击 `subject` 字段来自动填充。
    - **Operation**: 这里选择匹配规则。
        - 从下拉菜单中选择 `String` -> `contains` (包含)。
    - **Value 2**: 这里设置我们要检查的关键词。
        - 直接输入 `发票`。

- **配置完成后的样子应该是：**
    - **Value 1**: `{{ $json.subject }}`
    - **Operation**: `contains`
    - **Value 2**: `发票`

    *（可选）如果你希望匹配不区分大小写（比如 "Invoice" 或 "invoice"），可以在 Operation 中选择 `contains (case-insensitive)`。*

#### 3. 测试过滤器

- 回到工作流画布。
- 手动执行 `IMAP Email` 节点，让它获取一些邮件。
- 观察 `Filter` 节点的输出：
    - **OUTPUT: true**: 如果有邮件标题包含"发票"，这些邮件数据会从 `true` 输出口流出，进入下一个节点。
    - **OUTPUT: false**: 如果邮件标题不包含"发票"，这些数据会从 `false` 输出口流出，流程到此为止（因为我们没有连接 `false` 输出口）。

- 你可以点击 `Filter` 节点的 `true` 和 `false` 输出，查看哪些邮件被正确地分类了。

#### 4. 激活工作流

- 测试无误后，点击右上角的 "Active" 开关，激活你的工作流。

现在，你的自动化流程变得更智能了！它会 24/7 全天候监控你的邮箱，但只会把包含"发票"字样的邮件附件自动归档，其他邮件则不受影响。

## 总结

今天，我们学习了如何使用过滤器（Filter）来为工作流增加判断逻辑。这是一个非常强大且常用的功能，能够让你的自动化流程更加精准、高效和智能化。通过组合使用不同的条件，你可以构建出能应对各种复杂场景的自动化系统。

## 思考与扩展
- 如果你想同时处理包含"发票"或"收据"的邮件，该如何设置过滤器？（提示：Filter 节点可以添加多个条件，并设置它们之间的关系是 "AND" 还是 "OR"）
- 如果发件人是你的财务部门 `finance@example.com` **并且** 标题包含"发票"，才执行操作，该如何配置？ 